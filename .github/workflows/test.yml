name: test

on:
  - push
  - pull_request

jobs:
  deploy-and-test:
    name: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os:
          - macos-14
          - macos-15
          - ubuntu-22.04
          - ubuntu-24.04
    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
      - run: rm -f ~/.bash{_logout,_profile,rc} ~/.docker/config.json ~/.gitconfig ~/.profile
      - run: make deploy
      - run: make test
      - run: test "$(make test)" = 'done.'
  shellcheck:
    name: shellcheck
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
      - uses: docker://koalaman/shellcheck:stable
        with:
          args: >
            bash/.bashrc.d/interactive
            bash/.bashrc.d/login
            bash/.bashrc.d/logout
            bash/.bashrc.d/path
            bash/.bashrc.d/profile
            bash/.bash_logout
            bash/.bash_profile
            bash/.bashrc
