name: test

on:
  - push
  - pull_request

jobs:
  deploy-and-test:
    name: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os:
          - macos-13
          - macos-14
          - macos-15
          - ubuntu-22.04
          - ubuntu-24.04
    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@08eba0b27e820071cde6df949e0beb9ba4906955 # v4.3.0
      - run: rm -f ~/.bash{_logout,_profile,rc} ~/.docker/config.json ~/.gitconfig ~/.profile
      - run: make deploy
      - run: make test
      - run: test "$(make test)" = 'done.'
  shellcheck:
    name: shellcheck
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@08eba0b27e820071cde6df949e0beb9ba4906955 # v4.3.0
      - uses: docker://koalaman/shellcheck:stable
        with:
          args: >
            bash/.bash_logout
            bash/.bash_profile
            bash/.bashrc
            bash/.profile
  vint:
    name: vint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@08eba0b27e820071cde6df949e0beb9ba4906955 # v4.3.0
      - uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065 # v5.6.0
        with:
          python-version: 3.11
      - run: pip install vim-vint
      - run: >
          find vim \( -name '.vimrc*' -or -name '*.vim' \) -print0 |
          xargs -0 vint
